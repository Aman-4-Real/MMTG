'''
Author: Aman
Date: 2021-12-23 21:03:13
Contact: cq335955781@gmail.com
LastEditors: Aman
LastEditTime: 2021-12-23 21:55:21
'''
from transformers import BertTokenizer, GPT2LMHeadModel
import time as t
import torch

tokenizer = BertTokenizer.from_pretrained("uer/gpt2-chinese-cluecorpussmall")

# add the EOS token as PAD token to avoid warnings
print("start loading model")
model = GPT2LMHeadModel.from_pretrained("uer/gpt2-chinese-cluecorpussmall")
input_ids = tokenizer('我', add_special_tokens=False, return_tensors="pt")["input_ids"]
# input_ids = torch.tensor([tokenizer.convert_tokens_to_ids('[#START#]')])
print("start to generate")
t1 = t.time()
# set return_num_sequences > 1
beam_outputs = model.generate(
    input_ids, 
    max_length=40, 
    num_beams=10, 
    # no_repeat_ngram_size=2, 
    num_return_sequences=10, 
    # early_stopping=True
)
print("time:", t.time() - t1)
# now we have 3 output sequences
print("Output:\n" + 100 * '-')
for i, beam_output in enumerate(beam_outputs):
    print("{}: {}".format(i, tokenizer.decode(beam_output, skip_special_tokens=True)))



# tokenizer = BertTokenizer.from_pretrained("uer/gpt2-chinese-cluecorpussmall")
# model = GPT2LMHeadModel.from_pretrained("uer/gpt2-chinese-cluecorpussmall")
# text_generator = Pipeline(model, tokenizer)   
# text_generator("这", max_length=40, do_sample=True)







# from transformers import BertTokenizer
# tokenizer = BertTokenizer.from_pretrained("./vocab/vocab.txt")


# res = [[([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.672023159032873), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.833292286268493), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.099582969039364), \
#     ([1, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.726470492163262), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.84498009040807), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.908361593191575), \
#     ([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.9878818867758), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.270454648772912), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 800, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.42444669816255), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 671, 702, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -18.78885041766799)], \
#     [([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.665274350002639), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.822475661458357), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.10607842098784), \
#     ([1, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.740746397272403), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.810345850482786), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.903697463697014), \
#     ([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.980824600413936), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.24096735522564), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 800, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.373569275533026), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 671, 702, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -18.813122114199217)], \
#     [([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.654145410463618), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.828990135848747), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.069183023730954), \
#     ([1, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.742514911730083), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.808038034404305), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.900870124679496), \
#     ([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.957435335708613), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.227615440921568), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 800, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.376897522052964), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 671, 702, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -18.740858983981617)], \
#     [([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.659767992559315), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.829208380549582), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.042613795161078), \
#     ([1, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.745741128833448), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.862703228406772), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.866947058216805), \
#     ([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.959885911901363), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.22393199615985), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 800, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.40769754307082), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 671, 702, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -18.729560547260817)], \
#     [([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.63951544164214), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -14.825689074167549), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.034189587316767), \
#     ([1, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 2769, 812, 4638, 4263, 2658, 2218, 6821, 3416, 5310, 3338, 749, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.710276216615824), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 3766, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.8006187266326), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.889248981165963), \
#     ([1, 872, 3221, 1415, 6820, 6381, 2533, 2769, 2, 872, 3221, 1415, 6820, 6381, 2533, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -16.955538121828955), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.235609805343973), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 800, 2, 2769, 4638, 2552, 7027, 1372, 3300, 800, 3766, 3300, 800, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -17.401241654077314), \
#     ([1, 2769, 4638, 2552, 7027, 1372, 3300, 872, 3766, 3300, 1961, 2, 2769, 4638, 2552, 7027, 1372, 3300, 671, 702, 1961, 2, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], -18.69668755993793)]]

# for s in res:
#     for line in s:
#         preds = tokenizer.convert_ids_to_tokens(line[0])
#         while '[PAD]' in preds:
#             preds.remove('[PAD]')
#         print(preds)
#     print("-"*80)



